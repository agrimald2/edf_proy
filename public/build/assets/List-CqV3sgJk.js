import{_ as C}from"./GuestLayout-BPR-SgEs.js";import k from"./PermutaDetails-BCB1_Aqp.js";import{j as c,l as _,o as n,c as b,w as L,a as e,g as u,t as i,m as g,y as f,s as F,n as d,e as a,f as w,h as m,F as x}from"./app-BLH6_FXs.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Banner-DjKJ_Hrs.js";import"./PermutaRejectReasonModal-CmckyYn9.js";import"./PermutaApproveConfirmationModal-BaF290pZ.js";import"./PermutaApprovedModal-CsdnS_I6.js";import"./PermutaRejectedModal-DhuDJaOI.js";const M={components:{GuestLayout:C,PermutaDetails:k},props:["supervisor"],data(){const t=new Date().toLocaleString("es-ES",{month:"long"}).toLowerCase();return{todaysDate:new Date().toLocaleDateString("es-ES",{weekday:"short",year:"numeric",month:"short",day:"numeric"}).replace(/^\w/,s=>s.toUpperCase()),selectedFilter:"todos",selectedMonth:t,selectedRegion:"",selectedLocation:"",filteredLocations:[],permutas:[],regions:[],locations:[],searchQuery:"",showDetailModal:!1,selectedPermuta:null}},computed:{filteredPermutas(){return this.permutas.filter(t=>this.selectedFilter==="todos"?!0:this.selectedFilter==="approved"?t.trade_status.toLowerCase()==="approved":this.selectedFilter==="rejected"?t.trade_status.toLowerCase()==="rejected"||t.supervisor_status.toLowerCase()==="rejected"||t.gerente_status.toLowerCase()==="rejected":this.selectedFilter==="pending"?t.trade_status.toLowerCase()==="pending"&&t.supervisor_status.toLowerCase()!=="rejected"&&t.gerente_status.toLowerCase()!=="rejected":t.gerente_status.toLowerCase()===this.selectedFilter).filter(t=>{if(this.selectedMonth!=="todos"){const s={enero:0,febrero:1,marzo:2,abril:3,mayo:4,junio:5,julio:6,agosto:7,septiembre:8,octubre:9,noviembre:10,diciembre:11};if(new Date(t.created_at).getMonth()!==s[this.selectedMonth])return!1}return this.selectedRegion&&t.location.region.name!==this.selectedRegion||this.selectedLocation&&t.location.name!==this.selectedLocation?!1:t.cod_cliente.includes(this.searchQuery)||t.location.name.includes(this.searchQuery)})},approvedCount(){return this.permutas.filter(t=>t.trade_status.toLowerCase()==="approved").length},pendingCount(){return this.permutas.filter(t=>t.trade_status.toLowerCase()==="pending").length}},watch:{selectedRegion(t){this.filterLocationsByRegion()}},methods:{async getPermutas(){try{const t=await c.get("/api/trade/permutas");this.permutas=t.data}catch(t){console.error("Error fetching permutas:",t)}},async getRegions(){try{const t=await c.get("/api/regions");this.regions=t.data}catch(t){console.error("Error fetching regions:",t)}},async getLocations(){try{const t=await c.get("/api/locations");this.locations=t.data,this.filteredLocations=t.data}catch(t){console.error("Error fetching locations:",t)}},filterLocationsByRegion(){this.selectedRegion===""?this.filteredLocations=this.locations:this.filteredLocations=this.locations.filter(t=>t.sub_region.region_id===this.selectedRegion),this.selectedLocation=""},statusClass(t){switch(t.toLowerCase()){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},statusIcon(t){switch(t.toLowerCase()){case"approved":return"fa-solid fa-check";case"rejected":return"fa-solid fa-x";case"pending":return"fa-solid fa-spinner";default:return"fa-solid fa-question"}},openDetailModal(t){this.selectedPermuta=t,this.showDetailModal=!0},goBack(){window.location.href=`/mesa/${this.supervisor}/info`},logout(){c.post("/logout").then(t=>{window.location.href="/login"}).catch(t=>{console.error("Error during logout:",t)})},exportExcel(){window.location.href="/trade/pendingPermutas"},triggerFileInput(){this.$refs.fileInput.click()},async handleFileUpload(t){console.log("HOLA");const s=t.target.files[0];if(!s)return;const h=new FormData;h.append("file",s);try{const p=await c.post("/trade/importPendingPermutas",h,{headers:{"Content-Type":"multipart/form-data"}});console.log("Import successful:",p.data),this.getPermutas(),alert("Importación exitosa")}catch(p){console.error("Error importing permutas:",p),alert("Error durante la importación")}},openDetailModal(t){console.log("Opening detail modal for permuta ID:",t),this.selectedPermuta=this.permutas.find(s=>s.id===t),this.showDetailModal=!0},closeDetailModal(){console.log("Closing detail modal"),this.showDetailModal=!1,this.selectedPermuta=null}},mounted(){this.getPermutas(),this.getRegions(),this.getLocations()}},P={class:"flex items-center justify-between px-4 py-2 bg-white shadow-md border-b border-gray-200"},E=e("h3",{class:"text-center text-sm font-bold text-gray-800 flex-1"},"¡Hola Carla Estrada!",-1),R=e("i",{class:"fa-solid fa-sign-out-alt mr-2"},null,-1),j=[R],B={class:"flex flex-row gap-2 bg-white shadow-md rounded-lg overflow-hidden p-2 items-center"},I={class:"flex-1 text-center text-xs"},U=e("span",{class:"font-bold"}," Aprobadas: ",-1),V={class:"flex-1 text-center text-xs text-black"},A=e("span",{class:"font-bold"},"Pendientes: ",-1),S={class:"flex-1 text-center"},T=e("label",{class:"text-xs font-semibold mr-2"},"Mes:",-1),z=e("option",{selected:"",value:"todos"},"todos",-1),N=e("option",{value:"enero"},"Ene",-1),Q=e("option",{value:"febrero"},"Feb",-1),G=e("option",{value:"marzo"},"Mar",-1),O=e("option",{value:"abril"},"Abr",-1),q=e("option",{value:"mayo"},"May",-1),H=e("option",{value:"junio"},"Jun",-1),J=e("option",{value:"julio"},"Jul",-1),K=e("option",{value:"agosto"},"Ago",-1),W=e("option",{value:"septiembre"},"Sep",-1),X=e("option",{value:"octubre"},"Oct",-1),Y=e("option",{value:"noviembre"},"Nov",-1),Z=e("option",{value:"diciembre"},"Dic",-1),$=[z,N,Q,G,O,q,H,J,K,W,X,Y,Z],ee={class:"px-2"},te={class:"relative mx-auto text-gray-600 w-full"},oe=e("h2",{class:"font-bold text-sm text-black leading-tight pt-4 pb-2"}," Lista de Permutas ",-1),se={class:"flex gap-2 my-4 px-2"},re={key:0,class:"flex gap-2 my-4 px-2"},le={class:"flex gap-2 my-4 px-2"},ie=e("option",{value:""},"Todas las Regiones",-1),ne=["value"],ae=e("option",{value:""},"Todas las Localidades",-1),de=["value"],ce={class:"p-2 overflow-hidden shadow-xl sm:rounded-lg"},ue={class:"flex flex-col gap-4"},he={class:"w-3/5 border-r border-gray-200"},pe={class:"p-4"},ge={class:"text-sm font-semibold"},fe=e("i",{class:"fa-solid fa-user"},null,-1),me={class:"text-xs flex items-center justify-between"},xe={class:"bg-gray-100 rounded pt-1 pl-2 pb-1 pr-2 flex-3/4"},_e=e("i",{class:"fa-brands fa-square-letterboxd mr-2"},null,-1),be={class:"flex-1/4 text-right"},we={class:"mt-2"},ve={class:"w-2/5 text-left"},ye={class:"p-4 text-left"},Ce={class:"text-sm text-black font-bold"},ke={class:"text-xs mt-1 font-medium text-gray-500"},Le={class:"text-xs font-medium text-gray-500 mt-2"},Fe=["onClick"];function De(t,s,h,p,r,l){const v=_("PermutaDetails"),y=_("GuestLayout");return n(),b(y,{title:"Permutas | EDF"},{default:L(()=>[e("div",P,[E,e("button",{onClick:s[0]||(s[0]=(...o)=>l.logout&&l.logout(...o)),class:"absolute top-2 right-0 ml-4 flex items-center text-sm font-bold text-red-600"},j)]),e("div",B,[e("div",I,[U,u(" "+i(l.approvedCount),1)]),e("div",V,[A,u(" "+i(l.pendingCount),1)]),e("div",S,[T,g(e("select",{"onUpdate:modelValue":s[1]||(s[1]=o=>r.selectedMonth=o),class:"border border-gray-300 rounded-md text-xs p-1 px-2"},$,512),[[f,r.selectedMonth]])])]),e("div",ee,[e("div",te,[oe,g(e("input",{class:"border-2 border-gray-300 bg-white h-10 px-5 pr-16 rounded-lg text-sm focus:outline-none w-full",type:"search",name:"search",placeholder:"Buscar","onUpdate:modelValue":s[2]||(s[2]=o=>r.searchQuery=o)},null,512),[[F,r.searchQuery]])])]),e("div",se,[e("button",{class:d(["px-2 py-1 text-xs rounded-full border-black border-2",{"bg-black text-white":r.selectedFilter==="todos","bg-white text-black":r.selectedFilter!=="todos"}]),onClick:s[3]||(s[3]=o=>r.selectedFilter="todos")},"Todos",2),e("button",{class:d(["px-2 py-1 text-xs rounded-full border-black border-2",{"bg-black text-white":r.selectedFilter==="approved","bg-white text-black":r.selectedFilter!=="approved"}]),onClick:s[4]||(s[4]=o=>r.selectedFilter="approved")},"Aprobadas",2),e("button",{class:d(["px-2 py-1 text-xs rounded-full border-black border-2",{"bg-black text-white":r.selectedFilter==="rejected","bg-white text-black":r.selectedFilter!=="rejected"}]),onClick:s[5]||(s[5]=o=>r.selectedFilter="rejected")},"Rechazadas",2),e("button",{class:d(["px-2 py-1 text-xs rounded-full border-black border-2",{"bg-black text-white":r.selectedFilter==="pending","bg-white text-black":r.selectedFilter!=="pending"}]),onClick:s[6]||(s[6]=o=>r.selectedFilter="pending")},"Pendientes",2)]),r.selectedFilter==="pending"?(n(),a("div",re,[e("button",{class:"px-2 py-1 text-xs rounded-full border-black border-2 bg-blue-500 text-white",onClick:s[7]||(s[7]=(...o)=>l.exportExcel&&l.exportExcel(...o))},"Exportar Excel"),e("input",{type:"file",onChange:s[8]||(s[8]=(...o)=>l.handleFileUpload&&l.handleFileUpload(...o)),class:"hidden",ref:"fileInput"},null,544),e("button",{class:"px-2 py-1 text-xs rounded-full border-black border-2 bg-green-500 text-white",onClick:s[9]||(s[9]=(...o)=>l.triggerFileInput&&l.triggerFileInput(...o))},"Importar Excel")])):w("",!0),e("div",le,[g(e("select",{"onUpdate:modelValue":s[10]||(s[10]=o=>r.selectedRegion=o),onChange:s[11]||(s[11]=(...o)=>l.filterLocationsByRegion&&l.filterLocationsByRegion(...o)),class:"form-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},[ie,(n(!0),a(x,null,m(r.regions,o=>(n(),a("option",{key:o.id,value:o.id},i(o.name),9,ne))),128))],544),[[f,r.selectedRegion]]),g(e("select",{"onUpdate:modelValue":s[12]||(s[12]=o=>r.selectedLocation=o),class:"form-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},[ae,(n(!0),a(x,null,m(r.filteredLocations,o=>(n(),a("option",{key:o.id,value:o.name},i(o.name),9,de))),128))],512),[[f,r.selectedLocation]])]),e("div",ce,[e("div",ue,[(n(!0),a(x,null,m(l.filteredPermutas,o=>(n(),a("div",{key:o.id,class:"bg-white shadow-md rounded-lg overflow-hidden flex"},[e("div",he,[e("div",pe,[e("div",ge,[fe,u(" "+i(o.cod_cliente)+" - "+i(o.location.name),1)]),e("div",me,[e("div",xe,[_e,u(" "+i(o.have_edf?"Cuenta con EDF":"No cuenta con EDF"),1)]),e("div",be,i(o.volume)+" CU ",1)]),e("div",we,[e("span",{class:d([l.statusClass(o.trade_status),"text-xs font-semibold mr-2 px-2.5 py-1 rounded"])},[e("i",{class:d(l.statusIcon(o.trade_status))},null,2),u(" "+i(o.trade_status==="Approved"?"Aprobada":o.trade_status==="Rejected"?"Rechazada":o.trade_status==="Pending"?"Pendiente":o.trade_status),1)],2)])])]),e("div",ve,[e("div",ye,[e("div",Ce,i(o.subcanal),1),e("div",ke," Ruta: "+i(o.route),1),e("div",Le,[e("button",{class:"bg-red-500 text-white font-bold py-1 px-2 rounded-md w-full",onClick:Me=>l.openDetailModal(o)},"Ver más",8,Fe)])])])]))),128))])]),r.showDetailModal?(n(),b(v,{key:1,show:r.showDetailModal,permuta:r.selectedPermuta,id:`Permuta${r.selectedPermuta.id}`,onClose:l.closeDetailModal},null,8,["show","permuta","id","onClose"])):w("",!0)]),_:1})}const Se=D(M,[["render",De]]);export{Se as default};
