import v from"./PermutaSent-BxreIclP.js";import{i as _,o as r,e as a,a as e,t as m,f as b,j as D,m as n,A as u,z as c,F as f,h as p,B as h,n as y,b as w}from"./app-B_6OdXCy.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E={components:{PermutaSent:v},props:{show:{type:Boolean,default:!1},sv:{type:String},ruta:{type:String}},data(){return{formData:{clientCode:"",volumeCU:"",location_id:"",route:this.ruta,subcanal:"",haveEdf:0,doorsToNegotiate:"",condition:"",reason:"",justification:"",sv:this.sv},reasons:[],locations:[],sentPermutaViewModal:!1,errorMessage:"",isSubmitting:!1}},mounted(){fetch("/api/permuta-reasons").then(i=>i.json()).then(i=>{this.reasons=i}).catch(i=>{console.error("Error fetching reasons:",i)}),fetch("/api/locations").then(i=>i.json()).then(i=>{this.locations=i}).catch(i=>{console.error("Error fetching locations:",i)})},computed:{isFormComplete(){return this.formData.location_id&&this.formData.clientCode&&this.formData.volumeCU&&this.formData.route&&this.formData.haveEdf!==""&&this.formData.doorsToNegotiate&&this.formData.condition&&this.formData.reason},doorsOptions(){const i=parseInt(this.formData.volumeCU),o=this.formData.condition.toUpperCase();let d=[];return i<20?o==="REPOTENCIADO"&&(d=[.5,1]):i<40?o==="REPOTENCIADO"?d=[.5,1,2]:o==="NUEVO"&&(d=[.5,1]):i<42?(o==="REPOTENCIADO"||o==="NUEVO")&&(d=[.5,1,2]):i<60?o==="REPOTENCIADO"?d=[.5,1,2,3]:o==="NUEVO"&&(d=[.5,1,2]):i>=60&&(o==="REPOTENCIADO"||o==="NUEVO")&&(d=[.5,1,2,3]),d}},methods:{closeModal(){this.$emit("close")},submitForm(){this.isFormComplete&&!this.isSubmitting?(this.isSubmitting=!0,fetch("/api/permutas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.formData)}).then(i=>{if(!i.ok)throw new Error("Network response was not ok");return i.json()}).then(i=>{console.log("Success:",i),this.showSentPermutaView()}).catch(i=>{console.error("Error:",i),this.errorMessage="Failed to submit permuta. Please try again."}).finally(()=>{this.isSubmitting=!1})):this.errorMessage="Please complete all fields before submitting."},showSentPermutaView(){this.sentPermutaViewModal=!0}}},x={class:"z-20 fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center"},V={key:0,class:"bg-white rounded-lg shadow-lg w-96 p-6 relative max-h-[85vh] overflow-y-auto",style:{"margin-left":"auto","margin-right":"auto","margin-top":"2rem"}},N=e("i",{class:"fa-solid fa-circle-xmark text-gray-500"},null,-1),S=[N],U=e("div",{class:"text-center mb-10 pt-6"},[e("h2",{class:"text-lg font-bold"},"Permutas"),e("p",null,"Ingresa los datos solicitados")],-1),M={key:0,class:"text-red-500 text-center mb-4"},O=e("p",{class:"font-semibold mb-2"},"Información del cliente",-1),k={class:"grid grid-cols-2 gap-4"},P={class:"grid grid-cols-2 gap-4"},F=e("option",{value:"",disabled:"",selected:""},"Locación",-1),T=["value"],j={class:"grid grid-cols-1 gap-4 mt-4"},A={class:"flex items-center justify-center"},I=e("label",{class:"mr-4"},"¿Cuenta con EDF?",-1),R={class:"flex items-center"},B=e("label",{for:"edfSi",class:"mr-4"},"SI",-1),z=e("label",{for:"edfNo"},"NO",-1),J=e("p",{class:"font-semibold"},"EDF a solicitar",-1),L={class:"mt-4 mb-2"},q={class:"grid grid-cols-2 gap-2"},G={class:"flex items-center"},H={class:"w-full"},K=e("option",{value:"",disabled:"",selected:""},"Condición",-1),Q=e("option",{value:"Nuevo"},"Nuevo",-1),W=e("option",{value:"Repotenciado"},"Repotenciado",-1),X=[K,Q,W],Y=["value"],Z={class:"mt-4"},$={class:"w-full"},ee=e("option",{value:"",disabled:"",selected:""},"Motivo",-1),te=["value"],oe={class:"grid grid-cols-1 gap-4 mt-4"},se={class:"mt-2 pt-2"},ie=["disabled"],le={class:"mt-2 text-center bg-white border rounded-lg py-2 border-black font-medium"},ne={key:1,class:"bg-white rounded-lg shadow-lg w-96 p-6"};function re(i,o,d,ae,s,l){const g=_("PermutaSent");return r(),a("div",x,[s.sentPermutaViewModal?(r(),a("div",ne,[w(g,{onAccept:l.closeModal},null,8,["onAccept"])])):(r(),a("div",V,[e("button",{onClick:o[0]||(o[0]=(...t)=>l.closeModal&&l.closeModal(...t)),class:"absolute top-2 right-2 text-gray-500 hover:text-gray-700"},S),U,e("div",null,[s.errorMessage?(r(),a("div",M,m(s.errorMessage),1)):b("",!0),e("form",{class:"space-y-4",onSubmit:o[13]||(o[13]=D((...t)=>l.submitForm&&l.submitForm(...t),["prevent"]))},[O,e("div",k,[e("div",null,[n(e("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>s.formData.clientCode=t),type:"text",placeholder:"Código de cliente",class:"w-full inputs_permutas"},null,512),[[u,s.formData.clientCode]])]),e("div",null,[n(e("input",{"onUpdate:modelValue":o[2]||(o[2]=t=>s.formData.volumeCU=t),type:"text",placeholder:"Volumen en CU",class:"w-full inputs_permutas"},null,512),[[u,s.formData.volumeCU]])])]),e("div",P,[e("div",null,[n(e("select",{"onUpdate:modelValue":o[3]||(o[3]=t=>s.formData.location_id=t),class:"w-full inputs_permutas"},[F,(r(!0),a(f,null,p(s.locations,t=>(r(),a("option",{key:t.id,value:t.id},m(t.name),9,T))),128))],512),[[c,s.formData.location_id]])]),e("div",null,[n(e("input",{"onUpdate:modelValue":o[4]||(o[4]=t=>s.formData.route=t),type:"text",placeholder:"Ruta",class:"w-full inputs_permutas"},null,512),[[u,s.formData.route]])])]),e("div",j,[e("div",null,[n(e("input",{"onUpdate:modelValue":o[5]||(o[5]=t=>s.formData.subcanal=t),type:"text",placeholder:"Subcanal",class:"w-full inputs_permutas"},null,512),[[u,s.formData.subcanal]])])]),e("div",A,[I,e("div",R,[n(e("input",{type:"radio",id:"edfSi",value:"1","onUpdate:modelValue":o[6]||(o[6]=t=>s.formData.haveEdf=t),class:"mr-1"},null,512),[[h,s.formData.haveEdf]]),B,n(e("input",{type:"radio",id:"edfNo",value:"0","onUpdate:modelValue":o[7]||(o[7]=t=>s.formData.haveEdf=t),class:"mr-1"},null,512),[[h,s.formData.haveEdf]]),z])]),J,e("div",L,[e("div",q,[e("div",G,[e("div",H,[n(e("select",{"onUpdate:modelValue":o[8]||(o[8]=t=>s.formData.condition=t),class:"w-full inputs_permutas"},X,512),[[c,s.formData.condition]])])]),e("div",null,[n(e("select",{"onUpdate:modelValue":o[9]||(o[9]=t=>s.formData.doorsToNegotiate=t),class:"w-full inputs_permutas"},[(r(!0),a(f,null,p(l.doorsOptions,t=>(r(),a("option",{key:t,value:t},m(t),9,Y))),128))],512),[[c,s.formData.doorsToNegotiate]])])])]),e("div",Z,[e("div",$,[n(e("select",{"onUpdate:modelValue":o[10]||(o[10]=t=>s.formData.reason=t),class:"w-full inputs_permutas"},[ee,(r(!0),a(f,null,p(s.reasons,t=>(r(),a("option",{key:t.id,value:t.name},m(t.name),9,te))),128))],512),[[c,s.formData.reason]])]),e("div",oe,[e("div",null,[n(e("input",{"onUpdate:modelValue":o[11]||(o[11]=t=>s.formData.justification=t),type:"text",placeholder:"Justificación",class:"w-full inputs_permutas"},null,512),[[u,s.formData.justification]])])])]),e("div",se,[e("button",{disabled:!l.isFormComplete||s.isSubmitting,onClick:o[12]||(o[12]=(...t)=>l.submitForm&&l.submitForm(...t)),class:y(["w-full py-3 font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-opacity-50",l.isFormComplete&&!s.isSubmitting?"bg-black text-white hover:bg-gray-800 focus:ring-gray-400":"bg-gray-300 text-gray-500 hover:bg-blue-700 focus:ring-blue-400"])}," Enviar permuta ",10,ie)])],32),e("div",le,[e("button",{onClick:o[14]||(o[14]=(...t)=>l.closeModal&&l.closeModal(...t)),class:"text-black hover:underline focus:outline-none rounded-full"},"Cerrar")])])]))])}const ce=C(E,[["render",re]]);export{ce as default};
