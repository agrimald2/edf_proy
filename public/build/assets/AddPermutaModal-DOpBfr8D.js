import _ from"./PermutaSent-DvBTGPAb.js";import{i as b,o as n,e as a,a as t,t as m,f as w,j as D,k as r,v as u,n as c,G as C,F as f,h,B as g,A as p,b as y}from"./app-DGmb21sY.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const k={components:{PermutaSent:_},props:{show:{type:Boolean,default:!1},sv:{type:String},ruta:{type:String},location_id:{type:String}},data(){return{formData:{clientCode:"",volumeCU:"",location_id:this.location_id,route:this.ruta,subcanal:"",haveEdf:0,doorsToNegotiate:"",condition:"",reason:"",justification:"",sv:this.sv},reasons:[],locations:[],sentPermutaViewModal:!1,errorMessage:"",isSubmitting:!1,showError:!1,searchResults:[],selectedClient:null,showDropdown:!1}},mounted(){document.addEventListener("click",this.handleClickOutside),fetch("/api/permuta-reasons").then(o=>o.json()).then(o=>{this.reasons=o}).catch(o=>{console.error("Error fetching reasons:",o)}),fetch("/api/locations").then(o=>o.json()).then(o=>{this.locations=o}).catch(o=>{console.error("Error fetching locations:",o)})},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},computed:{isFormComplete(){return this.formData.location_id&&this.formData.clientCode&&this.formData.volumeCU&&this.formData.route&&this.formData.haveEdf!==""&&this.formData.doorsToNegotiate&&this.formData.condition&&this.formData.reason},doorsOptions(){const o=parseInt(this.formData.volumeCU),e=this.formData.condition.toUpperCase();let d=[];return o<20?e==="REPOTENCIADO"&&(d=[.5,1]):o<40?e==="REPOTENCIADO"?d=[.5,1,2]:e==="NUEVO"&&(d=[.5,1]):o<42?(e==="REPOTENCIADO"||e==="NUEVO")&&(d=[.5,1,2]):o<60?e==="REPOTENCIADO"?d=[.5,1,2,3]:e==="NUEVO"&&(d=[.5,1,2]):o>=60&&(e==="REPOTENCIADO"||e==="NUEVO")&&(d=[.5,1,2,3]),d},locationName(){const o=this.locations.find(e=>e.id===this.formData.location_id);return o?o.name:""}},watch:{"formData.clientCode"(o){o.length>=3?this.searchClients(o):this.searchResults=[]},selectedClient(o,e){o&&(this.formData.volumeCU=o.volumen_cu)}},methods:{closeModal(){this.$emit("close")},submitForm(){this.isFormComplete&&!this.isSubmitting?(this.isSubmitting=!0,fetch("/api/permutas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.formData)}).then(o=>o.ok?o.json():o.json().then(e=>{throw console.dir(e),new Error(e.error||"Network response was not ok")})).then(o=>{console.log("Success:",o),this.showSentPermutaView()}).catch(o=>{console.error("Error:",o),this.errorMessage=`ERROR: ${o.message}`,this.showError=!0}).finally(()=>{this.isSubmitting=!1})):(this.errorMessage="Please complete all fields before submitting.",this.showError=!0)},showSentPermutaView(){this.sentPermutaViewModal=!0},searchClients(o){fetch(`/api/customers/search/${o}`).then(e=>e.json()).then(e=>{this.searchResults=e}).catch(e=>{console.error("Error fetching clients:",e)})},selectClient(o){this.selectedClient=o,this.formData.clientCode=o.code},handleClickOutside(o){this.$refs.search&&!this.$refs.search.contains(o.target)&&(this.showDropdown=!1)}}},x={class:"z-20 fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center"},N={key:0,class:"bg-white rounded-lg shadow-lg w-96 p-6 relative max-h-[85vh] overflow-y-auto",style:{"margin-left":"auto","margin-right":"auto","margin-top":"2rem"}},S=t("i",{class:"fa-solid fa-circle-xmark text-gray-500"},null,-1),U=[S],O=t("div",{class:"text-center mb-10 pt-6"},[t("h2",{class:"text-lg font-bold"},"Permutas"),t("p",null,"Ingresa los datos solicitados")],-1),V={key:0,class:"text-red-500 text-center mb-4"},M=t("p",{class:"font-semibold mb-2"},"Información del cliente",-1),P={class:"grid grid-cols-2 gap-4"},R={class:"relative",ref:"search"},F={class:"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg"},j=["onClick"],T={class:"grid grid-cols-2 gap-4"},A=["value"],I={class:"grid grid-cols-1 gap-4 mt-4"},B={class:"flex items-center justify-center"},z=t("label",{class:"mr-4"},"¿Cuenta con EDF?",-1),L={class:"flex items-center"},J=t("label",{for:"edfSi",class:"mr-4"},"SI",-1),G=t("label",{for:"edfNo"},"NO",-1),q=t("p",{class:"font-semibold"},"EDF a solicitar",-1),H={class:"mt-4 mb-2"},K={class:"grid grid-cols-2 gap-2"},Q={class:"flex items-center"},W={class:"w-full"},X=t("option",{value:"",disabled:"",selected:""},"Condición",-1),Y=t("option",{value:"Nuevo"},"Nuevo",-1),Z=t("option",{value:"Repotenciado"},"Repotenciado",-1),$=[X,Y,Z],ee=["value"],te={class:"mt-4"},oe={class:"w-full"},se=t("option",{value:"",disabled:"",selected:""},"Motivo",-1),ie=["value"],le={class:"grid grid-cols-1 gap-4 mt-4"},re={class:"mt-2 pt-2"},ne=["disabled"],ae={class:"mt-2 text-center bg-white border rounded-lg py-2 border-black font-medium"},de={key:1,class:"bg-white rounded-lg shadow-lg w-96 p-6"};function ue(o,e,d,ce,i,l){const v=b("PermutaSent");return n(),a("div",x,[i.sentPermutaViewModal?(n(),a("div",de,[y(v,{onAccept:l.closeModal},null,8,["onAccept"])])):(n(),a("div",N,[t("button",{onClick:e[0]||(e[0]=(...s)=>l.closeModal&&l.closeModal(...s)),class:"absolute top-2 right-2 text-gray-500 hover:text-gray-700"},U),O,t("div",null,[i.errorMessage?(n(),a("div",V,m(i.errorMessage),1)):w("",!0),t("form",{class:"space-y-4",onSubmit:e[14]||(e[14]=D((...s)=>l.submitForm&&l.submitForm(...s),["prevent"]))},[M,t("div",P,[t("div",R,[r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.formData.clientCode=s),type:"tel",placeholder:"Código de cliente",class:c(["w-full inputs_permutas",i.showError&&i.formData.clientCode===""?"border-red-500":""]),onFocus:e[2]||(e[2]=s=>i.showDropdown=!0),onBlur:e[3]||(e[3]=s=>o.setTimeout(()=>i.showDropdown=!1,100))},null,34),[[u,i.formData.clientCode]]),r(t("ul",F,[(n(!0),a(f,null,h(i.searchResults,s=>(n(),a("li",{key:s.code,class:"p-2 hover:bg-gray-100 cursor-pointer",onClick:me=>l.selectClient(s)},m(s.code),9,j))),128))],512),[[C,i.showDropdown&&i.searchResults.length]])],512),t("div",null,[r(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>i.formData.volumeCU=s),type:"tel",placeholder:"Volumen en CU",class:c(["w-full inputs_permutas",i.showError&&i.formData.volumeCU===""?"border-red-500":""])},null,2),[[u,i.formData.volumeCU]])])]),t("div",T,[t("div",null,[t("input",{type:"text",class:"w-full inputs_permutas",disabled:"",value:l.locationName},null,8,A)]),t("div",null,[r(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>i.formData.route=s),type:"text",placeholder:"Ruta",disabled:"",class:"w-full inputs_permutas"},null,512),[[u,i.formData.route]])])]),t("div",I,[t("div",null,[r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>i.formData.subcanal=s),type:"text",placeholder:"Subcanal",class:c(["w-full inputs_permutas",i.showError&&i.formData.subcanal===""?"border-red-500":""])},null,2),[[u,i.formData.subcanal]])])]),t("div",B,[z,t("div",L,[r(t("input",{type:"radio",id:"edfSi",value:"1","onUpdate:modelValue":e[7]||(e[7]=s=>i.formData.haveEdf=s),class:"mr-1"},null,512),[[g,i.formData.haveEdf]]),J,r(t("input",{type:"radio",id:"edfNo",value:"0","onUpdate:modelValue":e[8]||(e[8]=s=>i.formData.haveEdf=s),class:"mr-1"},null,512),[[g,i.formData.haveEdf]]),G])]),q,t("div",H,[t("div",K,[t("div",Q,[t("div",W,[r(t("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>i.formData.condition=s),class:"w-full inputs_permutas"},$,512),[[p,i.formData.condition]])])]),t("div",null,[r(t("select",{"onUpdate:modelValue":e[10]||(e[10]=s=>i.formData.doorsToNegotiate=s),class:"w-full inputs_permutas"},[(n(!0),a(f,null,h(l.doorsOptions,s=>(n(),a("option",{key:s,value:s},m(s),9,ee))),128))],512),[[p,i.formData.doorsToNegotiate]])])])]),t("div",te,[t("div",oe,[r(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>i.formData.reason=s),class:"w-full inputs_permutas"},[se,(n(!0),a(f,null,h(i.reasons,s=>(n(),a("option",{key:s.id,value:s.name},m(s.name),9,ie))),128))],512),[[p,i.formData.reason]])]),t("div",le,[t("div",null,[r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>i.formData.justification=s),type:"text",placeholder:"Justificación",class:c(["w-full inputs_permutas",i.showError&&i.formData.justification===""?"border-red-500":""])},null,2),[[u,i.formData.justification]])])])]),t("div",re,[t("button",{disabled:!l.isFormComplete||i.isSubmitting,onClick:e[13]||(e[13]=(...s)=>l.submitForm&&l.submitForm(...s)),class:c(["w-full py-3 font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-opacity-50",l.isFormComplete&&!i.isSubmitting?"bg-black text-white hover:bg-gray-800 focus:ring-gray-400":"bg-gray-300 text-gray-500 hover:bg-blue-700 focus:ring-blue-400"])}," Enviar permuta ",10,ne)])],32),t("div",ae,[t("button",{onClick:e[15]||(e[15]=(...s)=>l.closeModal&&l.closeModal(...s)),class:"text-black hover:underline focus:outline-none rounded-full"},"Cerrar")])])]))])}const ge=E(k,[["render",ue]]);export{ge as default};
