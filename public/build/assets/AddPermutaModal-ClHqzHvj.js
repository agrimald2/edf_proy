import _ from"./PermutaSent-DJmrmgQP.js";import{i as b,o as a,e as d,a as e,t as c,f as D,j as w,k as r,v as u,n as m,B as p,A as f,F as h,h as g,b as y}from"./app-B7of4Edt.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const C={components:{PermutaSent:_},props:{show:{type:Boolean,default:!1},sv:{type:String},ruta:{type:String},location_id:{type:String}},data(){return{formData:{clientCode:"",volumeCU:"",location_id:this.location_id,route:this.ruta,subcanal:"",haveEdf:0,doorsToNegotiate:"",condition:"",reason:"",justification:"",sv:this.sv},reasons:[],locations:[],sentPermutaViewModal:!1,errorMessage:"",isSubmitting:!1,showError:!1}},mounted(){fetch("/api/permuta-reasons").then(i=>i.json()).then(i=>{this.reasons=i}).catch(i=>{console.error("Error fetching reasons:",i)}),fetch("/api/locations").then(i=>i.json()).then(i=>{this.locations=i}).catch(i=>{console.error("Error fetching locations:",i)})},computed:{isFormComplete(){return this.formData.location_id&&this.formData.clientCode&&this.formData.volumeCU&&this.formData.route&&this.formData.haveEdf!==""&&this.formData.doorsToNegotiate&&this.formData.condition&&this.formData.reason},doorsOptions(){const i=parseInt(this.formData.volumeCU),t=this.formData.condition.toUpperCase();let n=[];return i<20?t==="REPOTENCIADO"&&(n=[.5,1]):i<40?t==="REPOTENCIADO"?n=[.5,1,2]:t==="NUEVO"&&(n=[.5,1]):i<42?(t==="REPOTENCIADO"||t==="NUEVO")&&(n=[.5,1,2]):i<60?t==="REPOTENCIADO"?n=[.5,1,2,3]:t==="NUEVO"&&(n=[.5,1,2]):i>=60&&(t==="REPOTENCIADO"||t==="NUEVO")&&(n=[.5,1,2,3]),n},locationName(){const i=this.locations.find(t=>t.id===this.formData.location_id);return i?i.name:""}},methods:{closeModal(){this.$emit("close")},submitForm(){this.isFormComplete&&!this.isSubmitting?(this.isSubmitting=!0,fetch("/api/permutas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.formData)}).then(i=>i.ok?i.json():i.json().then(t=>{throw console.dir(t),new Error(t.error||"Network response was not ok")})).then(i=>{console.log("Success:",i),this.showSentPermutaView()}).catch(i=>{console.error("Error:",i),this.errorMessage=`ERROR: ${i.message}`,this.showError=!0}).finally(()=>{this.isSubmitting=!1})):(this.errorMessage="Please complete all fields before submitting.",this.showError=!0)},showSentPermutaView(){this.sentPermutaViewModal=!0}}},x={class:"z-20 fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center"},N={key:0,class:"bg-white rounded-lg shadow-lg w-96 p-6 relative max-h-[85vh] overflow-y-auto",style:{"margin-left":"auto","margin-right":"auto","margin-top":"2rem"}},S=e("i",{class:"fa-solid fa-circle-xmark text-gray-500"},null,-1),U=[S],V=e("div",{class:"text-center mb-10 pt-6"},[e("h2",{class:"text-lg font-bold"},"Permutas"),e("p",null,"Ingresa los datos solicitados")],-1),M={key:0,class:"text-red-500 text-center mb-4"},O=e("p",{class:"font-semibold mb-2"},"Información del cliente",-1),k={class:"grid grid-cols-2 gap-4"},P={class:"grid grid-cols-2 gap-4"},F=["value"],j={class:"grid grid-cols-1 gap-4 mt-4"},R={class:"flex items-center justify-center"},T=e("label",{class:"mr-4"},"¿Cuenta con EDF?",-1),A={class:"flex items-center"},I=e("label",{for:"edfSi",class:"mr-4"},"SI",-1),B=e("label",{for:"edfNo"},"NO",-1),z=e("p",{class:"font-semibold"},"EDF a solicitar",-1),J={class:"mt-4 mb-2"},L={class:"grid grid-cols-2 gap-2"},q={class:"flex items-center"},G={class:"w-full"},H=e("option",{value:"",disabled:"",selected:""},"Condición",-1),K=e("option",{value:"Nuevo"},"Nuevo",-1),Q=e("option",{value:"Repotenciado"},"Repotenciado",-1),W=[H,K,Q],X=["value"],Y={class:"mt-4"},Z={class:"w-full"},$=e("option",{value:"",disabled:"",selected:""},"Motivo",-1),ee=["value"],te={class:"grid grid-cols-1 gap-4 mt-4"},oe={class:"mt-2 pt-2"},se=["disabled"],ie={class:"mt-2 text-center bg-white border rounded-lg py-2 border-black font-medium"},le={key:1,class:"bg-white rounded-lg shadow-lg w-96 p-6"};function re(i,t,n,ne,s,l){const v=b("PermutaSent");return a(),d("div",x,[s.sentPermutaViewModal?(a(),d("div",le,[y(v,{onAccept:l.closeModal},null,8,["onAccept"])])):(a(),d("div",N,[e("button",{onClick:t[0]||(t[0]=(...o)=>l.closeModal&&l.closeModal(...o)),class:"absolute top-2 right-2 text-gray-500 hover:text-gray-700"},U),V,e("div",null,[s.errorMessage?(a(),d("div",M,c(s.errorMessage),1)):D("",!0),e("form",{class:"space-y-4",onSubmit:t[12]||(t[12]=w((...o)=>l.submitForm&&l.submitForm(...o),["prevent"]))},[O,e("div",k,[e("div",null,[r(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.formData.clientCode=o),type:"tel",placeholder:"Código de cliente",class:m(["w-full inputs_permutas",s.showError&&s.formData.clientCode===""?"border-red-500":""])},null,2),[[u,s.formData.clientCode]])]),e("div",null,[r(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.formData.volumeCU=o),type:"tel",placeholder:"Volumen en CU",class:m(["w-full inputs_permutas",s.showError&&s.formData.volumeCU===""?"border-red-500":""])},null,2),[[u,s.formData.volumeCU]])])]),e("div",P,[e("div",null,[e("input",{type:"text",class:"w-full inputs_permutas",disabled:"",value:l.locationName},null,8,F)]),e("div",null,[r(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.formData.route=o),type:"text",placeholder:"Ruta",disabled:"",class:"w-full inputs_permutas"},null,512),[[u,s.formData.route]])])]),e("div",j,[e("div",null,[r(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.formData.subcanal=o),type:"text",placeholder:"Subcanal",class:m(["w-full inputs_permutas",s.showError&&s.formData.subcanal===""?"border-red-500":""])},null,2),[[u,s.formData.subcanal]])])]),e("div",R,[T,e("div",A,[r(e("input",{type:"radio",id:"edfSi",value:"1","onUpdate:modelValue":t[5]||(t[5]=o=>s.formData.haveEdf=o),class:"mr-1"},null,512),[[p,s.formData.haveEdf]]),I,r(e("input",{type:"radio",id:"edfNo",value:"0","onUpdate:modelValue":t[6]||(t[6]=o=>s.formData.haveEdf=o),class:"mr-1"},null,512),[[p,s.formData.haveEdf]]),B])]),z,e("div",J,[e("div",L,[e("div",q,[e("div",G,[r(e("select",{"onUpdate:modelValue":t[7]||(t[7]=o=>s.formData.condition=o),class:"w-full inputs_permutas"},W,512),[[f,s.formData.condition]])])]),e("div",null,[r(e("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>s.formData.doorsToNegotiate=o),class:"w-full inputs_permutas"},[(a(!0),d(h,null,g(l.doorsOptions,o=>(a(),d("option",{key:o,value:o},c(o),9,X))),128))],512),[[f,s.formData.doorsToNegotiate]])])])]),e("div",Y,[e("div",Z,[r(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>s.formData.reason=o),class:"w-full inputs_permutas"},[$,(a(!0),d(h,null,g(s.reasons,o=>(a(),d("option",{key:o.id,value:o.name},c(o.name),9,ee))),128))],512),[[f,s.formData.reason]])]),e("div",te,[e("div",null,[r(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>s.formData.justification=o),type:"text",placeholder:"Justificación",class:m(["w-full inputs_permutas",s.showError&&s.formData.justification===""?"border-red-500":""])},null,2),[[u,s.formData.justification]])])])]),e("div",oe,[e("button",{disabled:!l.isFormComplete||s.isSubmitting,onClick:t[11]||(t[11]=(...o)=>l.submitForm&&l.submitForm(...o)),class:m(["w-full py-3 font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-opacity-50",l.isFormComplete&&!s.isSubmitting?"bg-black text-white hover:bg-gray-800 focus:ring-gray-400":"bg-gray-300 text-gray-500 hover:bg-blue-700 focus:ring-blue-400"])}," Enviar permuta ",10,se)])],32),e("div",ie,[e("button",{onClick:t[13]||(t[13]=(...o)=>l.closeModal&&l.closeModal(...o)),class:"text-black hover:underline focus:outline-none rounded-full"},"Cerrar")])])]))])}const me=E(C,[["render",re]]);export{me as default};
