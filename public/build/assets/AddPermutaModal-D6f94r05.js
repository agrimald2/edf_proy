import b from"./PermutaSent-DFgxvMjS.js";import{l as _,o as n,e as a,a as t,t as m,f as D,i as w,m as r,s as u,n as c,v as C,F as f,h,D as g,y as p,b as y}from"./app-BHKn7OIF.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={components:{PermutaSent:b},props:{show:{type:Boolean,default:!1},sv:{type:String},ruta:{type:String},location_id:{type:String}},data(){return{formData:{clientCode:"",volumeCU:"",location_id:this.location_id,route:this.ruta,subcanal:"",haveEdf:0,doorsToNegotiate:"",condition:"",reason:"",justification:"",sv:this.sv},disableVolumeCU:!1,reasons:[],locations:[],sentPermutaViewModal:!1,errorMessage:"",isSubmitting:!1,showError:!1,searchResults:[],selectedClient:null,showDropdown:!1}},mounted(){document.addEventListener("click",this.handleClickOutside),fetch("/api/permuta-reasons").then(o=>o.json()).then(o=>{this.reasons=o}).catch(o=>{console.error("Error fetching reasons:",o)}),fetch("/api/locations").then(o=>o.json()).then(o=>{this.locations=o}).catch(o=>{console.error("Error fetching locations:",o)})},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},computed:{isFormComplete(){return this.formData.location_id&&this.formData.clientCode&&this.formData.volumeCU&&this.formData.route&&this.formData.haveEdf!==""&&this.formData.doorsToNegotiate&&this.formData.condition&&this.formData.reason},doorsOptions(){const o=this.formData.condition.toUpperCase();let e=[];return o==="NUEVO"?e=[1,2]:o==="REPOTENCIADO"&&(e=[.5,1,2]),e},oldDoorsOptions(){const o=parseInt(this.formData.volumeCU),e=this.formData.condition.toUpperCase();let d=[];return e==="NUEVO"?d=[2]:o<20?e==="REPOTENCIADO"&&(d=[.5,1]):o<40?e==="REPOTENCIADO"&&(d=[.5,1,2]):o<42?e==="REPOTENCIADO"&&(d=[.5,1,2]):o<60?e==="REPOTENCIADO"&&(d=[.5,1,2,3]):o>=60&&e==="REPOTENCIADO"&&(d=[.5,1,2,3]),d},locationName(){const o=this.locations.find(e=>e.id===this.formData.location_id);return o?o.name:""}},watch:{"formData.clientCode"(o){o.length>=3?this.searchClients(o):this.searchResults=[]},selectedClient(o,e){o&&(this.formData.volumeCU=o.volumen_cu)}},methods:{closeModal(){this.$emit("close")},submitForm(){this.isFormComplete&&!this.isSubmitting?(this.isSubmitting=!0,fetch("/api/permutas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.formData)}).then(o=>o.ok?o.json():o.json().then(e=>{throw console.dir(e),new Error(e.error||"Network response was not ok")})).then(o=>{console.log("Success:",o),this.showSentPermutaView()}).catch(o=>{console.error("Error:",o),this.errorMessage=`ERROR: ${o.message}`,this.showError=!0}).finally(()=>{this.isSubmitting=!1})):(this.errorMessage="Please complete all fields before submitting.",this.showError=!0)},showSentPermutaView(){this.sentPermutaViewModal=!0},searchClients(o){fetch(`/api/customers/search/${o}`).then(e=>e.json()).then(e=>{this.searchResults=e,e.length===0&&(this.disableVolumeCU=!1)}).catch(e=>{console.error("Error fetching clients:",e)})},selectClient(o){this.selectedClient=o,this.formData.clientCode=o.code,this.disableVolumeCU=!0},handleClickOutside(o){this.$refs.search&&!this.$refs.search.contains(o.target)&&(this.showDropdown=!1)}}},k={class:"z-20 fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center"},x={key:0,class:"bg-white rounded-lg shadow-lg w-96 p-6 relative max-h-[85vh] overflow-y-auto",style:{"margin-left":"auto","margin-right":"auto","margin-top":"2rem"}},S=t("i",{class:"fa-solid fa-circle-xmark text-gray-500"},null,-1),N=[S],O=t("div",{class:"text-center mb-10 pt-6"},[t("h2",{class:"text-lg font-bold"},"Permutas"),t("p",null,"Ingresa los datos solicitados")],-1),V={key:0,class:"text-red-500 text-center mb-4"},M=t("p",{class:"font-semibold mb-2"},"Información del cliente",-1),P={class:"grid grid-cols-2 gap-4"},R={class:"relative",ref:"search"},F={class:"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg"},T=["onClick"],j=["disabled"],I={class:"grid grid-cols-2 gap-4"},A=["value"],B={class:"grid grid-cols-1 gap-4 mt-4"},z={class:"flex items-center justify-center"},L=t("label",{class:"mr-4"},"¿Cuenta con EDF?",-1),J={class:"flex items-center"},q=t("label",{for:"edfSi",class:"mr-4"},"SI",-1),G=t("label",{for:"edfNo"},"NO",-1),H=t("p",{class:"font-semibold"},"EDF a solicitar",-1),K={class:"mt-4 mb-2"},Q={class:"grid grid-cols-2 gap-2"},W={class:"flex items-center"},X={class:"w-full"},Y=t("option",{value:"",disabled:"",selected:""},"Condición",-1),Z=t("option",{value:"Nuevo"},"Nuevo",-1),$=t("option",{value:"Repotenciado"},"Repotenciado",-1),ee=[Y,Z,$],te=["value"],oe={class:"mt-4"},se={class:"w-full"},ie=t("option",{value:"",disabled:"",selected:""},"Motivo",-1),le=["value"],re={class:"grid grid-cols-1 gap-4 mt-4"},ne={class:"mt-2 pt-2"},ae=["disabled"],de={class:"mt-2 text-center bg-white border rounded-lg py-2 border-black font-medium"},ue={key:1,class:"bg-white rounded-lg shadow-lg w-96 p-6"};function ce(o,e,d,me,i,l){const v=_("PermutaSent");return n(),a("div",k,[i.sentPermutaViewModal?(n(),a("div",ue,[y(v,{onAccept:l.closeModal},null,8,["onAccept"])])):(n(),a("div",x,[t("button",{onClick:e[0]||(e[0]=(...s)=>l.closeModal&&l.closeModal(...s)),class:"absolute top-2 right-2 text-gray-500 hover:text-gray-700"},N),O,t("div",null,[i.errorMessage?(n(),a("div",V,m(i.errorMessage),1)):D("",!0),t("form",{class:"space-y-4",onSubmit:e[14]||(e[14]=w((...s)=>l.submitForm&&l.submitForm(...s),["prevent"]))},[M,t("div",P,[t("div",R,[r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.formData.clientCode=s),type:"tel",placeholder:"Código de cliente",class:c(["w-full inputs_permutas",i.showError&&i.formData.clientCode===""?"border-red-500":""]),onFocus:e[2]||(e[2]=s=>i.showDropdown=!0),onBlur:e[3]||(e[3]=s=>o.setTimeout(()=>i.showDropdown=!1,100))},null,34),[[u,i.formData.clientCode]]),r(t("ul",F,[(n(!0),a(f,null,h(i.searchResults,s=>(n(),a("li",{key:s.code,class:"p-2 hover:bg-gray-100 cursor-pointer",onClick:fe=>l.selectClient(s)},m(s.code),9,T))),128))],512),[[C,i.showDropdown&&i.searchResults.length]])],512),t("div",null,[r(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>i.formData.volumeCU=s),type:"tel",placeholder:"Volumen en CU",disabled:i.disableVolumeCU,class:c(["w-full inputs_permutas",i.showError&&i.formData.volumeCU===""?"border-red-500":""])},null,10,j),[[u,i.formData.volumeCU]])])]),t("div",I,[t("div",null,[t("input",{type:"text",class:"w-full inputs_permutas",disabled:"",value:l.locationName},null,8,A)]),t("div",null,[r(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>i.formData.route=s),type:"text",placeholder:"Ruta",disabled:"",class:"w-full inputs_permutas"},null,512),[[u,i.formData.route]])])]),t("div",B,[t("div",null,[r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>i.formData.subcanal=s),type:"text",placeholder:"Subcanal",class:c(["w-full inputs_permutas",i.showError&&i.formData.subcanal===""?"border-red-500":""])},null,2),[[u,i.formData.subcanal]])])]),t("div",z,[L,t("div",J,[r(t("input",{type:"radio",id:"edfSi",value:"1","onUpdate:modelValue":e[7]||(e[7]=s=>i.formData.haveEdf=s),class:"mr-1"},null,512),[[g,i.formData.haveEdf]]),q,r(t("input",{type:"radio",id:"edfNo",value:"0","onUpdate:modelValue":e[8]||(e[8]=s=>i.formData.haveEdf=s),class:"mr-1"},null,512),[[g,i.formData.haveEdf]]),G])]),H,t("div",K,[t("div",Q,[t("div",W,[t("div",X,[r(t("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>i.formData.condition=s),class:"w-full inputs_permutas"},ee,512),[[p,i.formData.condition]])])]),t("div",null,[r(t("select",{"onUpdate:modelValue":e[10]||(e[10]=s=>i.formData.doorsToNegotiate=s),class:"w-full inputs_permutas"},[(n(!0),a(f,null,h(l.doorsOptions,s=>(n(),a("option",{key:s,value:s},m(s),9,te))),128))],512),[[p,i.formData.doorsToNegotiate]])])])]),t("div",oe,[t("div",se,[r(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>i.formData.reason=s),class:"w-full inputs_permutas"},[ie,(n(!0),a(f,null,h(i.reasons,s=>(n(),a("option",{key:s.id,value:s.name},m(s.name),9,le))),128))],512),[[p,i.formData.reason]])]),t("div",re,[t("div",null,[r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>i.formData.justification=s),type:"text",placeholder:"Justificación",class:c(["w-full inputs_permutas",i.showError&&i.formData.justification===""?"border-red-500":""])},null,2),[[u,i.formData.justification]])])])]),t("div",ne,[t("button",{disabled:!l.isFormComplete||i.isSubmitting,onClick:e[13]||(e[13]=(...s)=>l.submitForm&&l.submitForm(...s)),class:c(["w-full py-3 font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-opacity-50",l.isFormComplete&&!i.isSubmitting?"bg-black text-white hover:bg-gray-800 focus:ring-gray-400":"bg-gray-300 text-gray-500 hover:bg-blue-700 focus:ring-blue-400"])}," Enviar permuta ",10,ae)])],32),t("div",de,[t("button",{onClick:e[15]||(e[15]=(...s)=>l.closeModal&&l.closeModal(...s)),class:"text-black hover:underline focus:outline-none rounded-full"},"Cerrar")])])]))])}const ve=E(U,[["render",ce]]);export{ve as default};
