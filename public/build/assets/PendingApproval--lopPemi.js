import{_ as g}from"./GuestLayout-bzoUWYnG.js";import f from"./PendingPermutaItem-z1Jtyj5z.js";import{j as d,l as u,o as l,c,w as h,a as r,e as x,h as w,F as _}from"./app-78Pqa1lm.js";import{_ as y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Banner-Bpr0lmnr.js";import"./PermutaDetails-C-rX-bL7.js";import"./PermutaRejectReasonModal-C2aEhdw2.js";import"./PermutaApproveConfirmationModal-C8ZcxJYa.js";import"./PermutaApprovedModal-lKDE41pZ.js";import"./PermutaRejectedModal-BHUyErWu.js";const P={components:{GuestLayout:g,PendingPermutaItem:f},props:{mesa:{type:String},haveAvailableLimit:{type:Boolean}},data(){return{todaysDate:new Date().toLocaleDateString("es-ES",{weekday:"short",year:"numeric",month:"short",day:"numeric"}).replace(/^\w/,e=>e.toUpperCase()),selectedFilter:"todos",permutas:[],searchQuery:"",showDetailModal:!1,selectedPermuta:null,showAddPermutaModal:!1}},computed:{filteredPermutas(){return this.permutas.filter(e=>this.selectedFilter==="todos"?!0:this.selectedFilter==="approved"?e.trade_status.toLowerCase()==="approved":this.selectedFilter==="rejected"?e.trade_status.toLowerCase()==="rejected"||e.supervisor_status.toLowerCase()==="rejected"||e.gerente_status.toLowerCase()==="rejected":this.selectedFilter==="pending"?e.trade_status.toLowerCase()==="pending"&&e.supervisor_status.toLowerCase()!=="rejected"&&e.gerente_status.toLowerCase()!=="rejected":e.gerente_status.toLowerCase()===this.selectedFilter).filter(e=>e.cod_cliente.includes(this.searchQuery)||e.location.name.includes(this.searchQuery))},sortedPermutas(){return this.filteredPermutas.sort((e,t)=>e.supervisor_status==="Pending"&&t.supervisor_status!=="Pending"?-1:e.supervisor_status!=="Pending"&&t.supervisor_status==="Pending"?1:0)},approvedCount(){return this.permutas.filter(e=>e.trade_status.toLowerCase()==="approved").length},pendingCount(){return this.permutas.filter(e=>e.trade_status.toLowerCase()==="pending"&&e.supervisor_status.toLowerCase()!=="rejected"&&e.gerente_status.toLowerCase()!=="rejected").length}},methods:{async getPermutas(){try{const e=await d.get("/gerente/permutas/pending/list");this.permutas=e.data}catch(e){console.error("Error fetching permutas:",e)}},statusClass(e){switch(e.toLowerCase()){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},statusIcon(e){switch(e.toLowerCase()){case"approved":return"fa-solid fa-check";case"rejected":return"fa-solid fa-x";case"pending":return"fa-solid fa-spinner";default:return"fa-solid fa-question"}},openDetailModal(e){this.selectedPermuta=e,this.showDetailModal=!0},goBack(){window.location.href="/gerente/dashboard"},exportExcel(){window.location.href="/gerente/pendingPermutas"},triggerFileInput(){console.log("HOLA 2"),this.$refs.fileInput.click()},async handleFileUpload(e){console.log("HOLA 3");const t=e.target.files[0];if(!t)return;const n=new FormData;n.append("file",t);try{const a=await d.post("/gerente/importPendingPermutas",n,{headers:{"Content-Type":"multipart/form-data"}});console.log("Import successful:",a.data),this.getPermutas(),alert("Importación exitosa")}catch(a){console.error("Error importing permutas:",a),alert("Error durante la importación")}}},mounted(){this.getPermutas()}},b={class:"flex items-center justify-between px-4 py-2 bg-white shadow-md border-b border-gray-200"},v=r("i",{class:"fa-solid fa-chevron-left font-bold"},null,-1),C=[v],L=r("h3",{class:"text-center text-sm font-bold text-gray-800 flex-1"},"Permutas por aprobar",-1),k=r("div",{class:"px-2 flex justify-between items-center my-4"},[r("h2",{class:"font-bold text-sm text-black leading-tight"}," Lista de Permutas ")],-1),F={class:"flex gap-2 my-4 px-2"},D={class:"p-2 overflow-hidden shadow-xl sm:rounded-lg"},j={class:"flex flex-col gap-4"};function E(e,t,n,a,i,s){const p=u("PendingPermutaItem"),m=u("GuestLayout");return l(),c(m,{title:"Permutas | EDF"},{default:h(()=>[r("div",b,[r("button",{onClick:t[0]||(t[0]=o=>s.goBack()),class:"text-black text-sm hover:text-gray-800"},C),L]),k,r("div",F,[r("button",{class:"px-2 py-1 text-xs rounded-full border-black border-2 bg-blue-500 text-white",onClick:t[1]||(t[1]=(...o)=>s.exportExcel&&s.exportExcel(...o))},"Exportar Excel"),r("input",{type:"file",onChange:t[2]||(t[2]=(...o)=>s.handleFileUpload&&s.handleFileUpload(...o)),class:"hidden",ref:"fileInput"},null,544),r("button",{class:"px-2 py-1 text-xs rounded-full border-black border-2 bg-green-500 text-white",onClick:t[3]||(t[3]=(...o)=>s.triggerFileInput&&s.triggerFileInput(...o))},"Importar Excel")]),r("div",D,[r("div",j,[(l(!0),x(_,null,w(s.sortedPermutas,o=>(l(),c(p,{key:o.id,permuta:o,showDetailModal:i.showDetailModal,selectedPermuta:i.selectedPermuta,onOpenDetailModal:s.openDetailModal},null,8,["permuta","showDetailModal","selectedPermuta","onOpenDetailModal"]))),128))])])]),_:1})}const q=y(P,[["render",E]]);export{q as default};
